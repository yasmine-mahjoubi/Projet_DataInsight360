<div class="analyses-container">
    @if (notification()) {
        <div class="toast-wrapper">
            <div class="toast" [class.success]="notification()?.type==='success'" [class.error]="notification()?.type==='error'">
                <div class="toast-message">{{ notification()?.message }}</div>
                <button class="toast-close" (click)="clearNotification()">√ó</button>
            </div>
        </div>
    }
    <div class="analyses-header">
        <h1 class="page-title">Analyses Statistiques</h1>
        <p class="page-subtitle">Historique et r√©sultats de vos analyses</p>
    </div>

        <!-- Section des types d'analyses -->
    <div class="analyse-types">
        <div class="analyse-card">
            <span class="icon">üìä</span>
            <h3>Statistiques descriptives</h3>
        </div>

        <div class="analyse-card">
            <span class="icon">üîó</span>
            <h3>Corr√©lation</h3>

        </div>

        <div class="analyse-card">
            <span class="icon">üéØ</span>
            <h3>Valeurs aberrantes</h3>

        </div>

        <div class="analyse-card">
            <span class="icon">üìà</span>
            <h3>Histogramme</h3>
        </div>
    </div>

    <div class="analyses-toolbar">
        <div class="options-left">
        
        <!-- Filtre dataset -->
            <div class="filter-group">
                <select class="filter-select-modern"
                (change)="selectedDataset.set($any($event.target).value)">
                <option value="">Tous les datasets</option>
                @for (d of datasetOptions(); track d.id) {
                    <option [value]="d.id">{{ d.name }}</option>}
                </select>
            </div>
            <div class="separator"></div>
        <!-- Tri -->
            <div class="sort-group">
                <select class="sort-select-modern"
                (change)="sortOrder.set($any($event.target).value)">
                <option value="date-desc">R√©cent</option>
                <option value="date-asc">Ancien</option>
            </select>
            </div>

        </div>

        <div class="separator"></div>
        <div class="new-analyse-section">
            <button class="new-analyse-btn" (click)="createNewAnalyse()">
                <i class="ri-add-circle-fill"></i>
                Nouvelle analyse
            </button>
        </div>
    </div>
    <div class="analyses-list">

    @if (paginatedAnalyses().length === 0) {
        <p class="empty">Aucune analyse pour le moment.</p>
    } @else {
        @for (analyse of paginatedAnalyses(); track analyse.id) {
            <div class="analyse-card-item">
                <div class="left">
                    <span class="status" [class.success]="analyse.status=='Termin√©'"
                    [class.error]="analyse.status=='√âchec'">
                        ‚óè
                    </span>

                    <div class="texts">
                        <h3>{{ analyse.type }}</h3>
                        <p>Dataset : {{ analyse.datasetName }}</p>
                        <p>
                            Colonnes analys√©es :
                            <span *ngIf="analyse.column1 || analyse.result?.column || analyse.result?.columnX">
              <span *ngIf="analyse.column1">{{ analyse.column1 }}</span>
              <span *ngIf="!analyse.column1 && analyse.result?.column">{{ analyse.result.column }}</span>
              <span *ngIf="!analyse.column1 && analyse.result?.columnX">{{ analyse.result.columnX }}</span>
              <span *ngIf="analyse.column2">, {{ analyse.column2 }}</span>
              <span *ngIf="!analyse.column2 && analyse.result?.columnY">, {{ analyse.result.columnY }}</span>
            </span>
            <span *ngIf="!analyse.column1 && !analyse.result?.column && !analyse.result?.columnX">Non sp√©cifi√©es</span>
                        </p>
                        <p>{{ analyse.startedAt | date:'dd/MM/yyyy HH:mm' }}</p>
                        <p>{{ analyse.status }}</p>
                    </div>
                </div>

                <div class="buttons-group">
                    <button class="result-btn" (click)="openDetails(analyse.datasetId)">Voir les r√©sultats</button>
                    <button class="delete-btn" (click)="deleteAnalyse(analyse.id!)">Supprimer</button>
                </div>
            </div>
        }
    }
    </div>
    <div class="pagination">
        <button class="page-btn" [disabled]="page() === 1"(click)="prevPage()">‚óÄ Pr√©c√©dent</button>
        <span class="page-info">Page {{ page() }} / {{ totalPages() }}</span>
        <button class="page-btn" [disabled]="page() === totalPages()"(click)="nextPage()">Suivant ‚ñ∂</button>
    </div>

</div>